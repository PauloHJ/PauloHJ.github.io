<h1>Registrar nuevo beneficiario</h1>

<form method="POST">
  <div class="row">
    <div class="input-field col m6 s12">
      <input id="name" type="text" class="validate" name="name">
      <label for="name">Nombre</label>
    </div>

    <div class="input-field col m6 s12">
      <input id="last_name" type="text" class="validate"
        name="lastname">
      <label for="last_name">Apellido</label>
    </div>

    <div class="input-field col m6 s12">
      <label>
        <input type="checkbox" name="checkIndigena" id="checkIndigena" />
        <span>¿Es indigente?</span>
      </label>
    </div>
    <div class="input-field col m6 s12">
      <label>
        <input type="checkbox" name="checkExtrangero" id="checkExtrangero" />
        <span>¿Es extranjero?</span>
      </label>
    </div>

    <div class="input-field col m6 s12 margin-top">
      <select name="state" id="state" class="">
        <option value="" disabled selected>Seleccione...</option>
        <option value='AGUASCALIENTES'>AGUASCALIENTES</option>
        <option value='BAJA CALIFORNIA'>BAJA CALIFORNIA</option>
        <option value='BAJA CALIFORNIA SUR'>BAJA CALIFORNIA SUR</option>
        <option value='CAMPECHE'>CAMPECHE</option>
        <option value='CHIAPAS'>CHIAPAS</option>
        <option value='CHIHUAHA'>CHIHUAHA</option>
        <option value='CDMX'>CDMX</option>
        <option value='COAHUILA'>COAHUILA</option>
        <option value='COLIMA'>COLIMA</option>
        <option value='DURANGO'>DURANGO</option>
        <option value='GUANAJUATO'>GUANAJUATO</option>
        <option value='GUERRERO'>GUERRERO</option>
        <option value='HIDALGO'>HIDALGO</option>
        <option value='JALISCO'>JALISCO</option>
        <option value='EDOMEX'>EDOMEX</option>
        <option value='MICHOACAN'>MICHOACAN</option>
        <option value='MORELOS'>MORELOS</option>
        <option value='NAYARIT'>NAYARIT</option>
        <option value='NUEVO LEON'>NUEVO LEON</option>
        <option value='OAXACA'>OAXACA</option>
        <option value='PUEBLA'>PUEBLA</option>
        <option value='QUERETARO'>QUERETARO</option>
        <option value='QUINTANA ROO'>QUINTANA ROO</option>
        <option value='SAN LUIS POTOSI'>SAN LUIS POTOSI</option>
        <option value='SINALOA'>SINALOA</option>
        <option value='SONORA'>SONORA</option>
        <option value='TABASCO'>TABASCO</option>
        <option value='TAMAULIPAS'>TAMAULIPAS</option>
        <option value='TLAXCALA'>TLAXCALA</option>
        <option value='VERACRUZ'>VERACRUZ</option>
        <option value='YUCATAN'>YUCATAN</option>
        <option value='ZACATECAS'>ZACATECAS</option>

      </select>
      <label class="active">Estado</label>
    </div>
    <div class="input-field col m6 s12 margin-top" >
      <select name="city" id="city" class="browser-default">
      </select>
      <label class="active">Municipio</label>
    </div>

    <div class="input-field col m6 s12 margin-top" >
      <select name="zona" id="zona" class="">
        <option value="URBANA">Urbana</option>
        <option value="RURAL">Rural</option>
      </select>
      <label class="active">Zona Geográfica</label>
    </div>
  
    <div class="input-field col m6 s12">
      Fehca de Nacimiento
      <input type="date" name="nacimiento" id="nacimiento">
    </div>
    <div class="input-field col m6 s12">
      <input id="calle" name="calle"type="text" class="validate">
      <label for="calle">Calle</label>
    </div>
    
    <div class="input-field col m6 s12">
      <input id="numero" name="numero"type="text" class="validate">
      <label for="numero">Número</label>
    </div>
    
    <div class="input-field col m6 s12">
      <input id="cp" name="cp"type="text" class="validate">
      <label for="cp">Código Postal</label>
    </div>
    
    <div class="input-field col m6 s12">
      <input id="colonia" name="colonia"type="text" class="validate">
      <label for="colonia">Colonia</label>
    </div>

    <div class="input-field col m6 s12">
      <input id="curp" name="curp"type="text" class="validate">
      <label for="curp">CURP</label>
    </div>
    <div class="input-field col m6 s12">
      <input id="rfc" type="text" class="validate" name="rfc">
      <label for="rfc">RFC</label>
    </div>
    <div class="input-field col m6 s12">
      <input id="profesion" type="text" class="validate"
        name="profesion">
      <label for="profesion">Profesion</label>
    </div>

    <div class="input-field col m6 s12">
      <select id="sexo" name="sexo" class="">
        <option value="" disabled selected>Seleccione...</option>
        <option value="M">Masculino</option>
        <option value="F">Femenino</option>
      </select>
      <label for="first_name" class="active">Género</label>
    </div>
    <div class="input-field col m6 s12">
      <select id="estadoCivil" name="estadoCivil" class="">
        <option value="" disabled selected>Seleccione...</option>
        <option value="CASADO">Casado</option>
        <option value="DIVORCIADO">Divorciado</option>
        <option value="UNIONLIBRE">Union Libre</option>
        <option value="SOLTERO">Soltero</option>          
      </select>
      <label for="estadoCivil" class="active">Estado Civil</label>
    </div>
    <div class="input-field col m6 s12">
      <select id="canalizacion" name="canalizacion" class="">
        <option  disabled selected>Seleccione...</option>   
        {{#each bene}}
        <option value="{{id}}">{{contacto}}</option>
        {{/each}}      
      </select>
      <label for="canalizacion" class="active">Canalización</label>
    </div>
     <div class="input-field col m6 s12">
      <select multiple id="proyectos" name="proyectos" >
        <option  value="" disabled >Seleccione...</option>   
        {{#each proj}}
        <option value="{{id}}">{{nombre}}</option>
        {{/each}}      
      </select>
      <label for="proyectos" class="active">Proyectos</label>
    </div>
  </div>

  
  <button class="btn waves-effect waves-light red darken-2" type="submit" name="action">Registrar</button>

</form>


  <!--Testing JS for the cities-->
  <script src="/javascripts/mx-data.js"></script>
  <script src="/javascripts/new-proj-form.js"></script>
  <script>
    document.addEventListener('DOMContentLoaded', () => {
      $('.datepicker').datepicker();
      $('select').material_select();

      const checkIndigena = $("#checkIndigena");
      checkIndigena.on("click", () => {
        if(checkIndigena.is(':checked')) {
          $('#state').prop('disabled', true);
          $('#city').prop('disabled', true);
          $('select').material_select();
        } else {
          $('#state').prop('disabled', false);
          $('#city').prop('disabled', false); 
          $('select').material_select();
        }
      });
    });
  </script>
  
  
  
  <!--Testing camera-->
  <div id="myOnlineCamera">
    <video></video>
    <canvas></canvas>
    <button>Take Photo!</button>
  </div>
  <style>
  #myOnlineCamera video{width:320px;height:240px;margin:15px;float:left;}
  #myOnlineCamera canvas{width:320px;height:240px;margin:15px;float:left;}
  #myOnlineCamera button{clear:both;margin:30px;}
  </style>
  
  <script>

var videoObj    = { "video": true },
    errBack        = function(error){
        // alert("Video capture error: ", error.code);
    };

// Ask the browser for permission to use the Webcam
if(navigator.getUserMedia){                    // Standard
    navigator.getUserMedia(videoObj, startWebcam, errBack);
}else if(navigator.webkitGetUserMedia){        // WebKit
    navigator.webkitGetUserMedia(videoObj, startWebcam, errBack);
}else if(navigator.mozGetUserMedia){        // Firefox
    navigator.mozGetUserMedia(videoObj, startWebcam, errBack);
};

function startWebcam(stream){

    var myOnlineCamera    = getElementById('myOnlineCamera'),
        video            = myOnlineCamera.querySelectorAll('video'),
        canvas            = myOnlineCamera.querySelectorAll('canvas');

    video.width = video.offsetWidth;

    if(navigator.getUserMedia){                    // Standard
        video.src = stream;
        video.play();
    }else if(navigator.webkitGetUserMedia){        // WebKit
        video.src = window.webkitURL.createObjectURL(stream);
        video.play();
    }else if(navigator.mozGetUserMedia){        // Firefox
        video.src = window.URL.createObjectURL(stream);
        video.play();
    };

    // Click to take the photo
    $('#webcam-popup .takephoto').click(function(){
        // Copying the image in a temporary canvas
        var temp = document.createElement('canvas');

        temp.width  = video.offsetWidth;
        temp.height = video.offsetHeight;

        var tempcontext = temp.getContext("2d"),
            tempScale = (temp.height/temp.width);

        temp.drawImage(
            video,
            0, 0,
            video.offsetWidth, video.offsetHeight
        );

        // Resize it to the size of our canvas
        canvas.style.height    = parseInt( canvas.offsetWidth * tempScale );
        canvas.width        = canvas.offsetWidth;
        canvas.height        = canvas.offsetHeight;
        var context        = canvas.getContext("2d"),
            scale        = canvas.width/temp.width;
        context.scale(scale, scale);
        context.drawImage(bigimage, 0, 0);
    });
};

</script>
